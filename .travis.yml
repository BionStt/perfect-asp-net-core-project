language: csharp  
sudo: required  
dist: trusty  
mono: none
dotnet: 2.0.0
# whitelist
branches:
  only:
    - master
    - staging
    - production
install:
  - dotnet restore
script:  
  - dotnet test ./UnitTests
before_deploy: 
  - if [[ $TRAVIS_BRANCH == 'staging' ]]; then
    echo "Building for Staging...";
    export ASPNETCORE_ENVIRONMENT="Staging"; 
    dotnet publish ./WebUI -c Release -o ../release;
    zip -r publish.zip ./release/*;
    fi
  - if [[ $TRAVIS_BRANCH == 'production' ]]; then
    echo "Building for Production...";
    export ASPNETCORE_ENVIRONMENT="Production";
    dotnet publish ./WebUI -c Release -o ../release;
    zip -r publish.zip ./release/*;
    fi
deploy:
  # deploy to staging
  - provider: elasticbeanstalk
    access_key_id: "AKIAIXNRTSTH7RJEYEIA"
    secret_access_key:
     secure: "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"
    region: "us-east-2"  
    app: "perfect-asp-net-core-project"
    env: "PerfectAspNetCoreProjectStaging"
    bucket_name: "elasticbeanstalk-us-east-2-337708005292"
    zip_file: ./publish.zip
    skip_cleanup: true
    on:
      branch: staging
  # deploy to production
  - provider: elasticbeanstalk
    access_key_id: "AKIAIXNRTSTH7RJEYEIA"
    secret_access_key:
     secure: "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"
    region: "us-east-2"  
    app: "perfect-asp-net-core-project"
    env: "PerfectAspNetCoreProjectProduction"
    bucket_name: "elasticbeanstalk-us-east-2-337708005292"
    zip_file: ./publish.zip
    skip_cleanup: true
    on:
      branch: production